local a=0;local b=0x08;local function c(d,e)local f={}for g=1,#d do table.insert(f,d[g]+b+0x04+(e or 0))table.insert(f,d[g]+b+(e or 0))end;i2c.start(a)i2c.address(a,_WH1602.dev,i2c.TRANSMITTER)i2c.write(a,0x00,f)i2c.stop(a)end;local function h(i)if not _I2C then i2c.setup(a,i.sda,i.scl,i2c.SLOW)end;_WH1602={}_WH1602.dev=i.dev or 0x27;c({0x30})tmr.delay(4100)c({0x30})tmr.delay(100)c({0x30})c({0x20,0x20,0x80})c({0x00,0x10})c({0x00,0xc0})return true end;local function j(k)if k==1 then c({0x00,0xe0})else c({0x00,0xc0})end;return true end;local function l()c({0x00,0x10})return true end;local function m()c({0x00,0x20})return true end;local function n(i)if i.line==2 then c({0xc0,bit.lshift(i.col,4)})elseif i.line==1 then c({0x80,bit.lshift(i.col,4)})end;for g=1,#i.str do local o=string.byte(string.sub(i.str,g,g))c({bit.clear(o,0,1,2,3),bit.lshift(bit.clear(o,4,5,6,7),4)},1)end;return true end;return function(i)local e=false;if i.init then e=h(i.init)end;if _WH1602 then if i.cls then e=l()end;if i.home then e=m()end;if i.cursor then e=j(i.cursor)end;if i.lcd then e=n(i.lcd)end;if i.line1 then e=n({str=i.line1,line=1,col=0})end;if i.line2 then e=n({str=i.line2,line=2,col=0})end end;return e end
